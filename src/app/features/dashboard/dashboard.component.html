<!-- ‚îÄ‚îÄ‚îÄ Loading skeleton ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div *ngIf="isLoading" class="loading-state" aria-busy="true" aria-label="Cargando dashboard‚Ä¶">
  <div class="skeleton skeleton--title"></div>
  <div class="skeleton skeleton--text"></div>
  <div class="skeleton-grid">
    <div class="skeleton skeleton--card" *ngFor="let i of [1,2,3,4]"></div>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ Error state ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div *ngIf="!isLoading && loadError" class="error-state" role="alert">
  <p>‚ö†Ô∏è {{ loadError }}</p>
  <button (click)="ngOnInit()" class="btn-retry">Reintentar</button>
</div>

<!-- ‚îÄ‚îÄ‚îÄ Main dashboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<ng-container *ngIf="!isLoading && !loadError && (vm$ | async) as vm">
<div class="dashboard">

  <!-- ‚îÄ‚îÄ Welcome header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <header class="dash-header">
    <div>
      <h1 class="dash-title">
        Hola, {{ vm.user.fullName || vm.user.email }} üëã
      </h1>
      <p class="dash-subtitle">
        Plan actual:
        <span class="plan-badge plan-badge--{{ vm.profile.plan.slug }}">
          {{ vm.profile.plan.name }}
        </span>
        ¬∑ Contin√∫a practicando para conseguir tu pr√≥ximo trabajo.
      </p>
    </div>
  </header>

  <!-- ‚îÄ‚îÄ Plan usage widget ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="usage-section" aria-label="Uso del plan este mes">
    <div class="usage-header">
      <h2 class="section-title">Simulaciones este mes</h2>
      <span class="usage-count">{{ vm.usageLabel }}</span>
    </div>

    <div class="usage-bar-track" role="progressbar"
         [attr.aria-valuenow]="vm.usagePercent"
         aria-valuemin="0" aria-valuemax="100"
         [attr.aria-label]="vm.usageLabel + ' simulaciones usadas'">
      <div
        class="usage-bar-fill"
        [ngClass]="usageBarClass(vm.usagePercent)"
        [style.width.%]="vm.usagePercent">
      </div>
    </div>

    <p *ngIf="vm.usagePercent >= 90" class="usage-warning">
      ‚ö†Ô∏è Est√°s cerca de tu l√≠mite mensual.
      <a routerLink="/plans" class="link-upgrade">Actualiza tu plan ‚Üí</a>
    </p>
  </section>

  <!-- ‚îÄ‚îÄ Quick actions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="section" aria-label="Acciones r√°pidas">
    <h2 class="section-title">Acciones r√°pidas</h2>
    <div class="quick-grid">

      <a routerLink="/simulator" class="quick-card quick-card--primary">
        <span class="qc-icon">‚ñ∂</span>
        <div>
          <h3 class="qc-title">Iniciar simulaci√≥n</h3>
          <p class="qc-desc">Practica con preguntas t√©cnicas en tiempo real.</p>
        </div>
      </a>

      <a routerLink="/history" class="quick-card">
        <span class="qc-icon">üìã</span>
        <div>
          <h3 class="qc-title">Historial</h3>
          <p class="qc-desc">Revisa todos tus intentos anteriores.</p>
        </div>
      </a>

      <a routerLink="/profile" class="quick-card">
        <span class="qc-icon">üë§</span>
        <div>
          <h3 class="qc-title">Mi perfil</h3>
          <p class="qc-desc">Actualiza tu informaci√≥n y links.</p>
        </div>
      </a>

      <a routerLink="/plans" class="quick-card">
        <span class="qc-icon">‚òÖ</span>
        <div>
          <h3 class="qc-title">Ver planes</h3>
          <p class="qc-desc">Accede a funcionalidades avanzadas.</p>
        </div>
      </a>

    </div>
  </section>

  <!-- ‚îÄ‚îÄ Recent attempts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="section" aria-label="√öltimos intentos">
    <h2 class="section-title">√öltimos intentos</h2>

    <div *ngIf="vm.recentAttempts.length === 0" class="empty-state">
      <p>A√∫n no tienes intentos. ¬°Comienza tu primera simulaci√≥n!</p>
      <a routerLink="/simulator" class="btn-primary">Ir al simulador ‚Üí</a>
    </div>

    <div *ngIf="vm.recentAttempts.length > 0" class="attempts-list">
      <div
        *ngFor="let attempt of vm.recentAttempts"
        class="attempt-row">

        <div class="attempt-info">
          <span class="attempt-title">{{ attempt.simulation?.title }}</span>
          <span class="attempt-diff attempt-diff--{{ attempt.simulation?.difficulty }}">
            {{ attempt.simulation?.difficulty }}
          </span>
        </div>

        <div class="attempt-meta">
          <span
            class="attempt-score"
            [class.attempt-score--good]="(attempt.score ?? 0) >= 70"
            [class.attempt-score--bad]="(attempt.score ?? 0) < 50">
            {{ formatScore(attempt.score) }}
          </span>
          <span class="attempt-status attempt-status--{{ attempt.status }}">
            {{ attempt.status }}
          </span>
          <time class="attempt-date" [attr.datetime]="attempt.created_at">
            {{ attempt.created_at | date:'dd MMM yyyy' }}
          </time>
        </div>

      </div>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ Technical scores by technology ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="section" aria-label="Puntajes por tecnolog√≠a">
    <h2 class="section-title">Puntaje t√©cnico por tecnolog√≠a</h2>

    <div *ngIf="vm.technicalScores.length === 0" class="empty-state">
      <p>Completa simulaciones para ver tu puntaje por tecnolog√≠a.</p>
    </div>

    <div *ngIf="vm.technicalScores.length > 0" class="scores-grid">
      <div
        *ngFor="let score of vm.technicalScores"
        class="score-card">

        <div class="score-card__header">
          <img
            *ngIf="score.technology?.icon_url"
            [src]="score.technology.icon_url"
            [alt]="score.technology.name"
            class="tech-icon"
            width="24" height="24">
          <span class="tech-name">{{ score.technology?.name }}</span>
        </div>

        <div class="score-card__body">
          <span class="score-avg" [class.score-avg--good]="score.average_score >= 70">
            {{ score.average_score | number:'1.0-0' }}%
          </span>
          <div class="score-bar-track">
            <div
              class="score-bar-fill"
              [style.width.%]="score.average_score">
            </div>
          </div>
          <span class="score-attempts">{{ score.total_attempts }} intento(s)</span>
        </div>

      </div>
    </div>
  </section>

</div>
</ng-container>
